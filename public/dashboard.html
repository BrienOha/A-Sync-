<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - A-SYNC</title>
    <link rel="stylesheet" href="./css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="dashboard-layout">

    <div id="toast-container"></div>

    <aside class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-graduation-cap" style="margin-right: 10px;"></i>  A-SYNC
        </div>
        <nav class="sidebar-nav" id="sidebarNav"></nav>
        <div class="sidebar-footer">
            <div class="user-profile">
                <img id="profilePic" src="" alt="User">
                <div style="overflow: hidden;">
                    <p id="profileName" style="font-size: 0.9rem; font-weight: 700;">Loading...</p>
                    <p id="profileRole" style="font-size: 0.75rem; color: var(--text-muted);">...</p>
                </div>
            </div>
            <button id="logoutBtn" class="btn-logout" style="width: 100%; cursor: pointer;">
                <i class="fas fa-sign-out-alt"></i> Sign Out
            </button>
        </div>
    </aside>

    <div class="main-content">
        <header class="top-header">
            <div class="flex items-center gap-4">
                <h1 id="pageTitle" style="font-size: 1.25rem; font-weight: 800; color: var(--text-main);">Dashboard</h1>
                <span id="currentDate" style="background: #f3f4f6; padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; color: #4b5563;"></span>
            </div>
            <span class="badge badge-verified">
                <span style="width:8px;height:8px;background:currentColor;border-radius:50%;display:inline-block;margin-right:5px;"></span> 
                Backup Mode Active
            </span>
        </header>

        <div class="content-scroll">
            
            <!-- 1. DASHBOARD OVERVIEW -->
            <div id="home" class="section-content active">
                <h2 style="margin-bottom: 1.5rem; font-size: 1.25rem; font-weight: 700;">System Overview</h2>
                <div class="stats-grid" id="statsGrid"></div>
            </div>

            <!-- 2. SUBMIT DTR -->
            <div id="entry" class="section-content">
                <div class="card" style="max-width: 600px; margin: 0 auto;">
                    <h2 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">Submit Time Record</h2>
                    
                    <form id="dtrForm" onsubmit="submitDTR(event)">
                        <div class="form-group">
                            <label>Date of Attendance</label>
                            <input type="date" id="dtrDate" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>Time In</label>
                                <input type="time" id="dtrTimeIn" required>
                            </div>
                            <div class="form-group">
                                <label>Time Out</label>
                                <input type="time" id="dtrTimeOut" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Work Mode</label>
                            <select id="dtrMode">
                                <option value="Asynchronous Work">Asynchronous Work</option>
                                <option value="Emergency Leave">Emergency Leave</option>
                                <option value="Unable to Connect">Connectivity Issues</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Proof of Work</label>
                            <input type="file" id="dtrProof" accept="image/*,.pdf">
                            <small style="color:var(--text-muted); display:block; margin-top:0.25rem;">Attach screenshot, lesson plan, or medical cert.</small>
                        </div>
                        <div class="form-group">
                            <label>Remarks</label>
                            <textarea id="dtrRemarks" rows="3" placeholder="Briefly describe your output..."></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Submit Entry</button>
                    </form>
                </div>
            </div>

            <!-- 3. HISTORY TABLE -->
            <div id="history" class="section-content">
                <div class="card" style="padding: 0; overflow: hidden; border: none; background: transparent; box-shadow: none;">
                    <div class="table-container">
                        <table>
                            <thead><tr><th>Date & Time</th><th>Mode & Proof</th><th>Reason for Rejection</th><th class="text-center">Status</th></tr></thead>
                            <tbody id="historyTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 4. APPROVALS -->
            <div id="approval" class="section-content">
                <div class="card" style="padding: 0; overflow: hidden; border: none; background: transparent; box-shadow: none;">
                    <div class="flex justify-between items-center mb-4">
                        <h2 style="font-size: 1.1rem; font-weight: 700;">Pending Approvals</h2>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>Teacher</th><th>Time Log</th><th>Remarks & Proof</th><th class="text-center">Action</th></tr></thead>
                            <tbody id="approvalTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 5. REPORTS -->
            <div id="reports" class="section-content">
                <div class="card" style="padding: 0; overflow: hidden; border: none; background: transparent; box-shadow: none;">
                    <div class="flex justify-between items-center mb-4">
                        <h2 style="font-size: 1.1rem; font-weight: 700;">System Reports</h2>
                        <div class="flex gap-2">
                            <!-- UPDATED BUTTONS with new Classes -->
                            <button onclick="window.exportToExcel()" class="btn-secondary" style="color: #059669; border-color: #059669; background: #ecfdf5;">
                                <i class="fas fa-file-csv"></i> Export CSV
                            </button>
                            <button onclick="window.print()" class="btn-secondary">
                                <i class="fas fa-print"></i> Print View
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>Date</th><th>Teacher</th><th>Mode</th><th class="text-center">Status</th></tr></thead>
                            <tbody id="reportTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 6. USERS -->
            <div id="users" class="section-content">
                <div class="card" style="padding: 0; overflow: hidden; border: none; background: transparent; box-shadow: none;">
                    <div class="flex justify-between items-center mb-4">
                        <h2 style="font-size: 1.1rem; font-weight: 700;">User Access Control</h2>
                        <button onclick="addUserPrompt()" class="btn-primary" style="width: auto; padding: 8px 16px;">
                            <i class="fas fa-user-plus"></i> Add User
                        </button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>User Details</th>
                                    <th>Department</th>
                                    <th>System Role</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="userModal" class="modal-overlay" style="display: none;">
        <div class="modal-content card" style="max-width: 500px;">
            <div class="flex justify-between items-center mb-4">
                <h2 style="font-size: 1.25rem; font-weight: 700;">Add New User</h2>
                <button onclick="closeUserModal()" class="btn-icon"><i class="fas fa-times"></i></button>
            </div>
            
            <form id="addUserForm" onsubmit="handleCreateUser(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="newFullName" placeholder="e.g. John Doe" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="newEmail" placeholder="user@school.edu" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>System Role</label>
                        <select id="newRole">
                            <option value="Teacher">Teacher</option>
                            <option value="Head">Department Head</option>
                            <option value="Admin">Administrator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Department</label>
                        <select id="newDept">
                            <option value="Science">Science</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="English">English</option>
                            <option value="IT Office">IT Office</option>
                        </select>
                    </div>
                </div>
                <p style="font-size:0.8rem; color:var(--primary); margin-bottom:10px;">
                    <i class="fas fa-paper-plane"></i> The user will receive an email invitation to set their password.
                </p>
                <div style="margin-top: 1.5rem; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" onclick="closeUserModal()" class="btn-secondary" style="width: auto;">Cancel</button>
                    <button type="submit" class="btn-primary" style="width: auto;">Create User Profile</button>
                </div>
            </form>
        </div>
    </div>
    <script type="module" src="./js/dashboard.js"></script>
</body>
</html>